### 技能大赛可视化方向—后端部分

在已经编写好前端页面(并配置路由)的基础上：

#### 编写后端数据接口

后端接口开发项目结构如下：

![image-20221029192635938](D:\学习\大数据\技能大赛\学习笔记\学习笔记截图\后端数据接口开发项目结构.png)

其中：

- dao层主要负责与数据库进行交互(pymysql或者sqlalchemy)
- app.py部署后端服务(flask)

dao层代码结构：

看sqlalchemy笔记和pymysql代码

app代码基础架构：

````python
from flask import Flask
# 因为在互联网上传输的数据为json格式，因此需要引入jsonify转换
from flask import jsonify
# 因为涉及到前后端分离开发，因此需要解决跨域访问问题
from flask_cors import CORS

# 导入需要返回的数据
from dao.task1_data import task1_x,task1_y
from dao.task2_data import task2_x,task2_y
from dao.task3_data import task3_x,task3_benyue,task3_shangyue,task3_zong
# 实例化Flask对象
app = Flask(__name__)

# resource参数指明什么可以被跨域访问
CORS(app,resource=r'/*')
# 配置restful风格的数据接口(可以理解为一个可以返回数据的url)
@app.route('/task1/data')
# 定义一个方法(被上面的路由绑定着)
def task_1():
    # 相关的数据处理业务逻辑
    result = []
    for item in task1_x:
        tmp = {}
        tmp['name']=item
        tmp['value'] = task1_y[task1_x.index(item)]
        result.append(tmp)
    # 返回符合网络数据传输格式的json数据
    return jsonify(result)

@app.route('/task2/data')
def task_2():
    result = [task2_x,task2_y]
    return jsonify(result)

@app.route('/task3/data')
def task_3():
    result = [task3_x,task3_benyue,task3_shangyue,task3_zong]
    return jsonify(result)

# 程序入口
if __name__=="__main__":
    # 开启debug模式 可以看到请求记录
    app.run(debug=True)
````

Restful风格接口设计简介

我们平时设计的接口一般会包含相关的动词，比方说：getData，searchData等等，这种接口的功能比较单一，但是见名知意。rest风格的接口使用名词串联的方式来描述，比方说有关用户操作的接口可以统称为/User，根据请求方式的不同，判断是什么操作，比如put请求方式表示我想添加一条用户信息，get请求方式表示我想获取用户信息等等。

参考：

#### 前端请求后端数据接口并渲染数据

进入前端项目路径下：

````shell
cd 前端项目路径
cnpm install axios --save
````

在项目入口main.js中配置全局使用axios

````javascript
// The Vue build version to load with the `import` command
// (runtime-only or standalone) has been set in webpack.base.conf with an alias.
import Vue from 'vue'
import App from './App'
import * as echarts from 'echarts'
import router from './router'
import axios from 'axios'

Vue.prototype.$echarts = echarts
Vue.prototype.$axios = axios

Vue.config.productionTip = false

/* eslint-disable no-new */
new Vue({
  el: '#app',
  router,
  axios,
  components: { App },
  template: '<App/>'
})
````

前端代码结构

````vue
<template>
<div ref="main" style="width:600px;height:600px;"></div>
</template>

<script>
export default {
  name: "Task1",
  data(){
    return {
      option:{}
    }
  },
  methods:{
    getPage(){
      let tmp = {
        legend:{
          show:true,
          left:"center",
          top:"bottom"
        },
        title:{
          text:''
        },
        xAxis:{},
        yAxis:{},
        series:[{
          type:'pie',
          data:[]
        }]
      }
      // 请求接口返回数据
      this.$axios.get("http://127.0.0.1:5000/task1/data").then(response=>{
        let result = response.data
        // 数据渲染
        tmp.series[0].data = result
        this.option = tmp
        // 初始化echarts实例
        this.chart = this.$echarts.init(this.$refs.main)
        // 将之前定义好的配置应用于echarts实例
        this.chart.setOption(this.option)
      })
    }
  },
  mounted() {
    // 调用getPage生成页面
    this.getPage()
  }
}
</script>

<style scoped>

</style>
````

#### 运行项目

先运行app.py，启动后端服务

![image-20221029201506072](D:\学习\大数据\技能大赛\学习笔记\学习笔记截图\运行项目启动后端服务.png)

接着启动前端服务

````shell
cd 前端项目路径
npm run dev
````

浏览器展示

![image-20221029201646298](D:\学习\大数据\技能大赛\学习笔记\学习笔记截图\运行项目浏览器截图.png)